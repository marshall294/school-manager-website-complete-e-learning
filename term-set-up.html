<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Term Setup | ORLI Academy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      margin: 0;
    }
    header {
      background: #004d99;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 1.8rem;
    }
    .container {
      max-width: 750px;
      margin: 30px auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      padding: 30px;
    }
    label { display: block; margin-top: 15px; font-weight: bold; }
    select, input[type="date"] {
      width: 100%; padding: 10px; border-radius: 5px;
      border: 1px solid #ccc; margin-top: 5px;
    }
    button {
      margin-top: 20px; padding: 12px 18px;
      background: #00796b; color: white;
      border: none; border-radius: 5px; cursor: pointer;
      font-size: 16px;
    }
    button:hover { background: #004d40; }
    .message { margin-top: 15px; font-weight: bold; color: green; }
    .error { color: red; font-weight: bold; }
    .list { margin-top: 30px; border-top: 2px solid #004d99; padding-top: 10px; }
    .term-section {
      background: #e8f3ff;
      border-radius: 8px;
      margin-top: 20px;
      padding: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    .term-section h4 {
      background: #004d99;
      color: white;
      padding: 10px;
      border-radius: 6px;
      margin: 0 0 10px 0;
      font-size: 1.1rem;
    }
    .term-item {
      background: #f9fcff;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      line-height: 1.6;
      border-left: 5px solid #004d99;
    }
    .term-item button {
      margin-right: 8px;
      background: #004d99;
      font-size: 14px;
      padding: 6px 12px;
    }
    .term-item .delete-btn {
      background: #d32f2f;
    }
    .term-item .delete-btn:hover {
      background: #b71c1c;
    }
  </style>
</head>
<body>

<header>ğŸ—“ï¸ Term Setup â€” ORLI Academy</header>

<div class="container">
  <label>Class</label>
  <select id="class">
    <option value="">-- Select --</option>
    <option>Year 1</option>
    <option>Year 2</option>
    <option>Year 3</option>
    <option>Year 4</option>
    <option>Year 5</option>
    <option>Year 6</option>
  </select>

  <label>Academic Year</label>
  <select id="year">
    <option value="">-- Select --</option>
    <option>2024â€“2025</option>
    <option>2025â€“2026</option>
    <option>2026â€“2027</option>
    <option>2027â€“2028</option>
    <option>2028â€“2029</option>
    <option>2029â€“2030</option>
  </select>

  <label>Term</label>
  <select id="term">
    <option value="">-- Select --</option>
    <option>First Term</option>
    <option>Second Term</option>
    <option>Third Term</option>
  </select>

  <label>Start Date</label>
  <input type="date" id="startDate">

  <label>End Date</label>
  <input type="date" id="endDate">

  <button id="saveBtn" onclick="saveTerm()">ğŸ’¾ Save Term Info</button>
  <p id="msg" class="message"></p>

  <div class="list">
    <h3>ğŸ“˜ Saved Term Information</h3>
    <div id="termList"></div>
  </div>
</div>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC3Ef_ZnjmU_X2JJDbUlDYv6enGkuuW2n0",
    authDomain: "school-6425b.firebaseapp.com",
    databaseURL: "https://school-6425b-default-rtdb.firebaseio.com",
    projectId: "school-6425b",
    storageBucket: "school-6425b.firebasestorage.app",
    messagingSenderId: "929265479935",
    appId: "1:929265479935:web:af45ea5968ee50258a1cca"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const classSelect = document.getElementById("class");
  const yearSelect = document.getElementById("year");
  const termSelect = document.getElementById("term");
  const startDate = document.getElementById("startDate");
  const endDate = document.getElementById("endDate");
  const msg = document.getElementById("msg");
  const termList = document.getElementById("termList");
  const saveBtn = document.getElementById("saveBtn");

  let editMode = false;
  let editPath = "";

  function daysBetween(start, end) {
    const s = new Date(start);
    const e = new Date(end);
    return Math.ceil((e - s) / (1000 * 60 * 60 * 24)) + 1;
  }

  function saveTerm() {
    const c = classSelect.value.trim();
    const y = yearSelect.value.trim();
    const t = termSelect.value.trim();
    const s = startDate.value;
    const e = endDate.value;

    if (!c || !y || !t || !s || !e) {
      msg.textContent = "âš  Please fill all fields.";
      msg.className = "error";
      return;
    }

    const termData = { start: s, end: e };
    const path = `term_dates/${y}/${t}/${c}`;

    if (editMode && editPath) {
      db.ref(editPath).update(termData)
        .then(() => {
          msg.textContent = "âœ… Term updated successfully!";
          msg.className = "message";
          resetForm();
          loadTerms();
        });
    } else {
      db.ref(path).set(termData)
        .then(() => {
          msg.textContent = "âœ… Term information saved successfully!";
          msg.className = "message";
          resetForm();
          loadTerms();
        });
    }
  }

  function loadTerms() {
    termList.innerHTML = "<p>Loading...</p>";
    db.ref("term_dates").once("value").then(snapshot => {
      termList.innerHTML = "";
      if (!snapshot.exists()) {
        termList.innerHTML = "<p>No term data found.</p>";
        return;
      }

      snapshot.forEach(yearSnap => {
        const year = yearSnap.key;
        const yearSection = document.createElement("div");
        yearSection.className = "term-section";
        const yearTitle = document.createElement("h4");
        yearTitle.textContent = `ğŸ“† Academic Year: ${year}`;
        yearSection.appendChild(yearTitle);

        const yearData = yearSnap.val();
        for (const term in yearData) {
          const termTitle = document.createElement("h4");
          termTitle.style.background = "#0077cc";
          termTitle.textContent = `ğŸ—“ï¸ ${term}`;
          yearSection.appendChild(termTitle);

          for (const cls in yearData[term]) {
            const info = yearData[term][cls];
            const days = daysBetween(info.start, info.end);
            const div = document.createElement("div");
            div.className = "term-item";
            div.innerHTML = `
              <p>ğŸ« <b>Class:</b> ${cls}</p>
              <p>ğŸ“… <b>Start:</b> ${info.start}</p>
              <p>ğŸ“… <b>End:</b> ${info.end}</p>
              <p>ğŸ“ˆ <b>School Days:</b> ${days}</p>
              <button onclick="editTerm('${year}','${term}','${cls}','${info.start}','${info.end}')">âœï¸ Edit</button>
              <button class="delete-btn" onclick="deleteTerm('${year}','${term}','${cls}')">ğŸ—‘ï¸ Delete</button>
            `;
            yearSection.appendChild(div);
          }
        }

        termList.appendChild(yearSection);
      });
    });
  }

  function editTerm(year, term, cls, start, end) {
    yearSelect.value = year;
    termSelect.value = term;
    classSelect.value = cls;
    startDate.value = start;
    endDate.value = end;

    editMode = true;
    editPath = `term_dates/${year}/${term}/${cls}`;
    saveBtn.textContent = "âœï¸ Update Term Info";
    msg.textContent = "Editing mode â€” make changes and click Update.";
    msg.className = "message";
  }

  function deleteTerm(year, term, cls) {
    if (confirm(`Are you sure you want to delete ${term} - ${cls} (${year})?`)) {
      db.ref(`term_dates/${year}/${term}/${cls}`).remove()
        .then(() => {
          msg.textContent = "ğŸ—‘ï¸ Term deleted successfully.";
          msg.className = "message";
          loadTerms();
        })
        .catch(err => {
          msg.textContent = "âŒ Error: " + err.message;
          msg.className = "error";
        });
    }
  }

  function resetForm() {
    classSelect.value = "";
    yearSelect.value = "";
    termSelect.value = "";
    startDate.value = "";
    endDate.value = "";
    saveBtn.textContent = "ğŸ’¾ Save Term Info";
    editMode = false;
    editPath = "";
  }

  loadTerms();
</script>

</body>
</html>
